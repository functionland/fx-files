<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="Functionland.FxFiles.Client.App.Views.NativeVideoViewer"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:converters="clr-namespace:Functionland.FxFiles.Client.App.Views.Converters"
    xmlns:media="clr-namespace:CommunityToolkit.Maui.MediaElement;assembly=CommunityToolkit.Maui.MediaElement"
    NavigationPage.HasBackButton="False"
    NavigationPage.HasNavigationBar="False">
    <ContentPage.Resources>
        <ResourceDictionary>
            <Style TargetType="ImageButton">
                <Setter Property="BackgroundColor" Value="#212529" />
                <Setter Property="BorderColor" Value="Transparent" />
                <Setter Property="CornerRadius" Value="12" />
                <Setter Property="BorderWidth" Value="0" />
                <Setter Property="WidthRequest" Value="24" />
                <Setter Property="HeightRequest" Value="24" />
                <Setter Property="HorizontalOptions" Value="End" />
                <Setter Property="VerticalOptions" Value="CenterAndExpand" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>
    <Grid>
        <media:MediaElement
            x:Name="media"
            AutoPlay="True"
            ShowsPlaybackControls="False">
            <media:MediaElement.GestureRecognizers>
                <TapGestureRecognizer Tapped="media_Tapped" />
            </media:MediaElement.GestureRecognizers>
        </media:MediaElement>
        <StackLayout
            x:Name="header"
            BackgroundColor="#212529"
            HeightRequest="72"
            Orientation="Horizontal"
            VerticalOptions="StartAndExpand">
            <ImageButton
                Margin="20,0"
                Clicked="Back"
                HorizontalOptions="StartAndExpand"
                Source="back.png" />
            <ImageButton
                Margin="16,0"
                Clicked="Minimize"
                IsVisible="{OnIdiom Desktop=false,
                                    Default=true}"
                Source="pip.png" />
        </StackLayout>
        <StackLayout
            x:Name="mediaControls"
            BackgroundColor="#212529"
            HeightRequest="96"
            HorizontalOptions="FillAndExpand"
            VerticalOptions="EndAndExpand">
            <StackLayout.Resources>
                <ResourceDictionary>
                    <converters:TimeSpanToDoubleConverter x:Key="TimeSpanConverter" />
                    <converters:TimeSpanToStringConverter x:Key="TimeSpanStringConverter" />
                </ResourceDictionary>
            </StackLayout.Resources>
            <StackLayout
                Margin="21,0"
                BindingContext="{x:Reference media}"
                HeightRequest="48"
                Orientation="Vertical">
                <Slider
                    HeightRequest="35"
                    HorizontalOptions="FillAndExpand"
                    Maximum="{Binding Source={x:Reference media}, Path=Duration, Converter={StaticResource TimeSpanConverter}}"
                    MaximumTrackColor="#495057"
                    MinimumTrackColor="White"
                    ThumbColor="White"
                    Value="{Binding Source={x:Reference media}, Path=Position, Converter={StaticResource TimeSpanConverter}}">
                    <Slider.Triggers>
                        <DataTrigger
                            Binding="{Binding Source={x:Reference media}, Path=CurrentState}"
                            TargetType="Slider"
                            Value="{x:Static media:MediaElementState.Buffering}">
                            <Setter Property="IsEnabled" Value="False" />
                        </DataTrigger>
                    </Slider.Triggers>
                </Slider>
                <StackLayout Orientation="Horizontal">
                    <Label
                        HorizontalOptions="StartAndExpand"
                        Text="{Binding Source={x:Reference media}, Path=Position, Converter={converters:TimeSpanToStringConverter}}"
                        VerticalOptions="CenterAndExpand" />
                    <Label
                        HorizontalOptions="EndAndExpand"
                        Text="{Binding Source={x:Reference media}, Path=Duration, Converter={converters:TimeSpanToStringConverter}}"
                        VerticalOptions="CenterAndExpand" />
                </StackLayout>
            </StackLayout>
            <StackLayout
                HorizontalOptions="CenterAndExpand"
                Orientation="Horizontal"
                Spacing="12">
                <ImageButton
                    Clicked="Backward_Clicked"
                    HorizontalOptions="Center"
                    Source="backward.png" />
                <ImageButton
                    Clicked="PausePlay_Clicked"
                    HorizontalOptions="Center"
                    Source="play.png">
                    <ImageButton.Triggers>
                        <DataTrigger
                            Binding="{Binding Source={x:Reference media}, Path=CurrentState}"
                            TargetType="ImageButton"
                            Value="{x:Static media:MediaElementState.Playing}">
                            <Setter Property="Source" Value="pause.png" />
                        </DataTrigger>
                        <DataTrigger
                            Binding="{Binding Source={x:Reference media}, Path=CurrentState}"
                            TargetType="ImageButton"
                            Value="{x:Static media:MediaElementState.Paused}">
                            <Setter Property="Source" Value="play.png" />
                        </DataTrigger>
                        <DataTrigger
                            Binding="{Binding Source={x:Reference media}, Path=CurrentState}"
                            TargetType="ImageButton"
                            Value="{x:Static media:MediaElementState.Stopped}">
                            <Setter Property="Source" Value="play.png" />
                        </DataTrigger>
                    </ImageButton.Triggers>
                </ImageButton>
                <ImageButton
                    Clicked="Forward_Clicked"
                    HorizontalOptions="Center"
                    Source="forward.png" />
            </StackLayout>
        </StackLayout>
    </Grid>
</ContentPage>