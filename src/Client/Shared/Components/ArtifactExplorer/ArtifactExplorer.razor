@namespace Functionland.FxFiles.Client.Shared.Components
@implements IDisposable
@inherits AppComponentBase
@using Functionland.FxFiles.Client.Shared.Utils


<div class="list-container @(!Artifacts.Any() || Artifacts == null ? string.Empty : "list-view")" @ontouchstart="HandleTouchStart" @ontouchend="HandleTouchEnd" @onkeypress:preventDefault="true">
    @if (IsLoading)
    {
        <OverlayLoading LoadingType="LoadingType.Overlay" />
    }
    @if (((Artifacts == null) || (!Artifacts.Any())) && !IsLoading)
    {
        if (!IsInSearchMode)
        {
            <EmptyListView OnAddFolderButtonClick="OnAddFolderButtonClick"
                   Title="@Localizer[nameof(AppStrings.EmptyListTitle)]"
                   IsShowButtons="@(ArtifactExplorerMode != ArtifactExplorerMode.SelectDestionation && FileCategoryFilter == null)" />
        }
    }
    else
    {
        @if (Artifacts != null)
        {
            @if (ViewMode == ViewModeEnum.Grid)
            {
                <Virtualize Context="artifacts" OverscanCount="5" ItemsProvider="@ProvideArtifactGrid" @ref="_virtualizeGridRef">
                    <div style="display: flex">
                        @foreach (var artifact in artifacts)
                        {
                            <div class="item-container @(artifact.IsSelected == true ? "selected-item" : "") grid-view-item @(artifact.IsDisabled == true ? "disable-item" : "")"
                 @onpointerup="((e) => PointerUp(e,artifact))"
                 @onpointerdown="(() =>PointerDown(artifact))"
                 @onpointercancel="PointerCancel">

                                @if ((ArtifactExplorerMode == ArtifactExplorerMode.SelectArtifact || !IsPhone) && ArtifactExplorerMode != ArtifactExplorerMode.SelectDestionation)
                                {
                                    <div class="check-box-position" @onpointerup:stopPropagation="true" @onpointerdown:stopPropagation="true" @onmouseup:stopPropagation="true" @oncontextmenu:stopPropagation="true" @onclick:preventDefault="true" @onclick="(() => OnSelectionChanged(artifact))">
                                        <FxCheckBox IsChecked="@(artifact.IsSelected ?? false)" Class="@(!IsPhone ? "icon-space-in-desktop" : string.Empty)" />
                                    </div>
                                }
                                <div class="icon-box">
                                    <div class="thumbnail-box">
                                        <div class="img-box">
                                            @if (artifact?.ThumbnailPath != null && _isLoadingThumbnailFinished)
                                            {
                                                <img class="thumbnail-img" src="@(artifact.ThumbnailPath.InProtocol(Protocol))">
                                            }
                                        </div>
                                        @if (artifact?.FileCategory == FileCategoryType.Video && artifact?.ThumbnailPath != null)
                                        {
                                            <div class="icon-play"></div>
                                        }
                                    </div>
                                    <div class="item-icon-position @(artifact.IsSelected == true ? "selected-item-icon" : "")  @GetArtifactIcon(artifact)"></div>
                                </div>
                                <div class="footer-box">
                                    <div class="item-content">
                                        <div class="item-title">
                                            @if (artifact.IsPinned == true)
                                            {
                                                <div class="pin-badge"></div>
                                            }
                                            <div class="title-text @(artifact.IsPinned == true ? "space-pinned" : "disable-space-pinned")">@artifact.Name</div>
                                        </div>
                                        <div class="item-sub-text"></div>
                                    </div>
                                    @if ((ArtifactExplorerMode == ArtifactExplorerMode.Normal && !IsInRoot(CurrentArtifact)) || IsInSearchMode)
                                    {
                                        <div class="options-btn"
                         @onclick="() => HandleArtifactOptionClick(artifact)"
                         @onpointerup:preventDefault="true"
                         @onpointerup:stopPropagation="true"
                         @onpointerdown:preventDefault="true"
                         @onpointerdown:stopPropagation="true">
                                        </div>
                                    }
                                </div>
                            </div>
                        }
                    </div>
                </Virtualize>
            }
            else
            {
                <Virtualize Context="artifact" OverscanCount="5" ItemsProvider="@ProvideArtifactsList" @ref="_virtualizeListRef">
                    <div class="item-container @(artifact.IsSelected == true ? "selected-item" : "") list-view-item @(artifact.IsDisabled == true ? "disable-item" : "")"
             @onpointerup="((e) => PointerUp(e,artifact))"
             @onpointerdown="(() =>PointerDown(artifact))"
             @onpointercancel="PointerCancel">

                        @if ((ArtifactExplorerMode == ArtifactExplorerMode.SelectArtifact || !IsPhone) && ArtifactExplorerMode != ArtifactExplorerMode.SelectDestionation)
                        {
                            <div class="check-box-position" @onpointerup:stopPropagation="true" @onpointerdown:stopPropagation="true" @onmouseup:stopPropagation="true" @oncontextmenu:stopPropagation="true" @onclick:preventDefault="true" @onclick="(() => OnSelectionChanged(artifact))">
                                <FxCheckBox IsChecked="@(artifact.IsSelected ?? false)" Class="@(!IsPhone ? "icon-space-in-desktop" : string.Empty)" />
                            </div>
                        }
                        <div class="icon-box">
                            <div class="thumbnail-box">
                                <div class="img-box">
                                    @if (artifact?.ThumbnailPath != null && _isLoadingThumbnailFinished)
                                    {
                                        <img class="thumbnail-img" src="@(artifact.ThumbnailPath.InProtocol(Protocol))">
                                    }
                                </div>
                                @if (artifact?.FileCategory == FileCategoryType.Video && artifact?.ThumbnailPath != null)
                                {
                                    <div class="icon-play"></div>
                                }

                            </div>
                            <div class="item-icon-position @(artifact.IsSelected == true ? "selected-item-icon" : "")  @GetArtifactIcon(artifact)"></div>
                        </div>
                        <div class="footer-box">

                            <div class="item-content">
                                <div class="item-title">
                                    @if (artifact.IsPinned == true)
                                    {
                                        <div class="pin-badge"></div>
                                    }
                                    <div class="title-text @(artifact.IsPinned == true ? "space-pinned" : "disable-space-pinned")">@artifact.Name</div>
                                </div>
                                <div class="item-sub-text"></div>
                            </div>
                        </div>

                        @if ((ArtifactExplorerMode == ArtifactExplorerMode.Normal && !IsInRoot(CurrentArtifact)) || IsInSearchMode)
                        {
                            <div class="options-btn"
                 @onclick="() => HandleArtifactOptionClick(artifact)"
                 @onpointerup:preventDefault="true"
                 @onpointerup:stopPropagation="true"
                 @onpointerdown:preventDefault="true"
                 @onpointerdown:stopPropagation="true">
                            </div>
                        }
                    </div>
                </Virtualize>
            }
        }
    }
    <div class="position-scroll-btn">
        <FxButton Width="60px"
                  Height="60px"
                  BorderRadius="100px"
                  OnClick="OnGoToTopPage"
                  ButtonStyle="FxButtonStyle.IconOnly"
                  RightIcon="_content/Functionland.FxFiles.Client.Shared/images/icons/arrow-up.svg" />
    </div>
</div>
